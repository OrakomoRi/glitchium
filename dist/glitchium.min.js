class Glitchium{constructor(){this.activeGlitches=new Map}glitch(e=".glitch",t={}){const a={playMode:"always",trigger:null,intensity:.7,fps:15,layers:5,slice:{minHeight:.02,maxHeight:.2,hueRotate:!0},shake:!0,shakeIntensity:.15,pulse:!1,glitchTimeSpan:!1,filters:!0,hideOverflow:!1,createContainers:!0,smoothTransitions:!1,glitchFrequency:10,optimizeSeo:!0,...t};if(t.slice&&(a.slice={...a.slice,...t.slice}),a.glitchTimeSpan&&"object"==typeof a.glitchTimeSpan){const e=Math.max(0,Math.min(1,a.glitchTimeSpan.start||0)),t=Math.max(0,Math.min(1,a.glitchTimeSpan.end||1));a.glitchTimeSpan={start:e,end:t}}else!0===a.glitchTimeSpan&&(a.glitchTimeSpan={start:.25,end:.75});if(a.optimizeSeo&&this._isCrawler())return this._emptyControl();const r=this._getElements(e);if(!r.length)return this._emptyControl();const i=r.map((e=>this._glitchElement(e,a)));return{start:()=>i.forEach((e=>e.start())),stop:()=>i.forEach((e=>e.stop())),destroy:()=>i.forEach((e=>e.destroy()))}}_glitchElement(e,t){const{container:a,layersContainer:r,original:i}=this._prepareDOM(e,t),n=this._createLayers(i,r,t),s=Symbol("glitch");let l=null,o=!1,c=0,h=0,p=null;t.smoothTransitions&&(p=this._createInterpolationState(n,t));const m=e=>{if(!o)return;const a=1e3/t.fps;if(e-c<a)return void(l=requestAnimationFrame(m));c=e;const r=(e-h)%2e3/2e3;t.smoothTransitions&&p?this._updateWithInterpolation(n,p,e,t,r):n.forEach((e=>{e.isBase?t.shake?this._updateShake(e.element,t,r):(e.element.style.opacity="1",e.element.style.transform="none"):this._updateSlice(e.element,t,r)})),l=requestAnimationFrame(m)},u=()=>{o||(o=!0,h=performance.now(),l=requestAnimationFrame(m))},d=()=>{o=!1,l&&cancelAnimationFrame(l),n.forEach((e=>{e.element.style.transform="none",e.element.style.clipPath="none",e.element.style.opacity="0"})),n[0]&&(n[0].element.style.opacity="1")},y=()=>{d(),this.activeGlitches.delete(s),t.createContainers&&a.parentElement&&(a.parentElement.insertBefore(i,a),a.remove())};return this._setupPlayMode(a,t.playMode,t.trigger,u,d),this.activeGlitches.set(s,{start:u,stop:d,destroy:y}),{start:u,stop:d,destroy:y}}_prepareDOM(e,t){if(!t.createContainers)return{container:e,layersContainer:e,original:e.firstElementChild};const a=document.createElement("div"),r=document.createElement("div");return getComputedStyle(e).display.startsWith("inline")&&(a.style.display="inline-block"),r.style.display="grid",r.style.gridTemplateColumns="1fr",r.style.gridTemplateRows="1fr",t.hideOverflow&&(a.style.overflow="hidden"),a.appendChild(r),e.parentElement.insertBefore(a,e),r.appendChild(e),e.style.gridArea="1/1/-1/-1",{container:a,layersContainer:r,original:e}}_createLayers(e,t,a){const r=[{element:e,isBase:!0}];for(let i=0;i<a.layers;i++){const a=e.cloneNode(!0);a.style.gridArea="1/1/-1/-1",a.style.pointerEvents="none",a.style.userSelect="none",a.style.opacity="0",t.appendChild(a),r.push({element:a,isBase:!1})}return r}_createInterpolationState(e,t){const a={keyframeInterval:1e3/t.glitchFrequency,lastKeyframeUpdate:0,shake:{current:{x:0,y:0},target:{x:0,y:0}},slices:[]};return e.forEach(((e,t)=>{e.isBase||a.slices.push({current:{offsetX:0,clipTop:0,clipHeight:0,visible:!1,hue:0,saturate:!1,invert:!1},target:{offsetX:0,clipTop:0,clipHeight:0,visible:!1,hue:0,saturate:!1,invert:!1}})})),a}_updateWithInterpolation(e,t,a,r,i){a-t.lastKeyframeUpdate>=t.keyframeInterval&&(this._updateKeyframes(t,r,i),t.lastKeyframeUpdate=a);const n=Math.min((a-t.lastKeyframeUpdate)/t.keyframeInterval,1),s=this._easeOutQuad(n);let l=0;e.forEach((e=>{e.isBase?r.shake?this._updateShakeInterpolated(e.element,t.shake,s,r,i):(e.element.style.opacity="1",e.element.style.transform="none"):(this._updateSliceInterpolated(e.element,t.slices[l],s,r,i),l++)}))}_updateKeyframes(e,t,a=.5){const r=this._getGlitchFactor(t,a),i=t.intensity*r;e.shake.current.x=e.shake.target.x,e.shake.current.y=e.shake.target.y;const n=i*t.shakeIntensity;e.shake.target.x=(Math.random()-.5)*n*100,e.shake.target.y=(Math.random()-.5)*n*100,e.slices.forEach((e=>{const a=e.current,r=e.target;a.offsetX=r.offsetX,a.clipTop=r.clipTop,a.clipHeight=r.clipHeight,a.visible=r.visible,a.hue=r.hue,a.saturate=r.saturate,a.invert=r.invert,r.visible=Math.random()<=i,r.offsetX=(Math.random()-.5)*i*60;const n=100*t.slice.minHeight,s=100*t.slice.maxHeight;r.clipHeight=Math.random()*(s-n)+n,r.clipTop=Math.random()*(100-r.clipHeight),r.hue=t.slice.hueRotate?Math.floor(360*Math.random()):0,r.saturate=Math.random()>.5,r.invert=Math.random()>.7}))}_lerp(e,t,a){return e+(t-e)*a}_easeOutQuad(e){return e*(2-e)}_updateShakeInterpolated(e,t,a,r,i){let n=`translate3d(${this._lerp(t.current.x,t.target.x,a)}%, ${this._lerp(t.current.y,t.target.y,a)}%, 0)`;if(r.pulse){n+=` scale(${1+.05*Math.sin(i*Math.PI*2)})`}e.style.transform=n,e.style.opacity="1"}_updateSliceInterpolated(e,t,a,r,i){if(!(a<.5?t.current.visible:t.target.visible))return void(e.style.opacity="0");e.style.opacity="1";let n=`translate3d(${this._lerp(t.current.offsetX,t.target.offsetX,a)}%, 0, 0)`;if(r.pulse){n+=` scale(${1+.05*Math.sin(i*Math.PI*2)})`}e.style.transform=n;const s=this._lerp(t.current.clipTop,t.target.clipTop,a),l=this._lerp(t.current.clipHeight,t.target.clipHeight,a);if(e.style.clipPath=`polygon(0 ${s}%, 100% ${s}%, 100% ${s+l}%, 0 ${s+l}%)`,r.filters){const i=Math.round(this._lerp(t.current.hue,t.target.hue,a)),n=a<.5?t.current.saturate:t.target.saturate,s=a<.5?t.current.invert:t.target.invert,l=n?`saturate(${2+3*Math.random()})`:"",o=s?"invert(1)":"",c=r.slice.hueRotate?`hue-rotate(${i}deg)`:"";e.style.filter=`${c} ${l} ${o}`.trim()}}_updateShake(e,t,a){const r=this._getGlitchFactor(t,a),i=t.intensity*t.shakeIntensity*r;let n=`translate3d(${(Math.random()-.5)*i*100}%, ${(Math.random()-.5)*i*100}%, 0)`;if(t.pulse){n+=` scale(${1+.05*Math.sin(a*Math.PI*2)})`}e.style.transform=n,e.style.opacity="1"}_updateSlice(e,t,a){const r=this._getGlitchFactor(t,a),i=t.intensity*r;if(Math.random()>i)return void(e.style.opacity="0");e.style.opacity="1";let n=`translate3d(${(Math.random()-.5)*i*60}%, 0, 0)`;if(t.pulse){n+=` scale(${1+.05*Math.sin(a*Math.PI*2)})`}e.style.transform=n;const s=this._randomClipPath(100*t.slice.minHeight,100*t.slice.maxHeight);if(e.style.clipPath=s,t.filters){const a=t.slice.hueRotate?Math.floor(360*Math.random()):0,r=Math.random()>.5?`saturate(${2+3*Math.random()})`:"",i=Math.random()>.7?"invert(1)":"",n=t.slice.hueRotate?`hue-rotate(${a}deg)`:"";e.style.filter=`${n} ${r} ${i}`.trim()}}_randomClipPath(e=2,t=20){const a=Math.random()*(t-e)+e,r=Math.random()*(100-a);return`polygon(0 ${r}%, 100% ${r}%, 100% ${r+a}%, 0 ${r+a}%)`}_setupPlayMode(e,t,a,r,i){let n=e;switch(a&&("string"==typeof a?n=document.querySelector(a):a instanceof HTMLElement&&(n=a)),n||(n=e),e.onmouseenter=null,e.onmouseleave=null,e.onclick=null,n!==e&&(n.onmouseenter=null,n.onmouseleave=null,n.onclick=null),t){case"always":r();break;case"hover":n.onmouseenter=r,n.onmouseleave=i;break;case"click":n.onclick=()=>{i(),setTimeout(r,50)};break;case"manual":break}}_getElements(e){return"string"==typeof e?Array.from(document.querySelectorAll(e)):e instanceof NodeList?Array.from(e):Array.isArray(e)?e:e instanceof HTMLElement?[e]:[]}_emptyControl(){return{start:()=>{},stop:()=>{},destroy:()=>{}}}_isCrawler(){if("undefined"==typeof navigator)return!1;const e=navigator.userAgent.toLowerCase();return["googlebot","bingbot","slurp","duckduckbot","baiduspider","yandexbot","facebot","ia_archiver","chrome-lighthouse"].some((t=>e.includes(t)))}_getGlitchFactor(e,t){if(!e.glitchTimeSpan)return 1;const{start:a,end:r}=e.glitchTimeSpan;if(t<a||t>r)return 0;const i=a+(r-a)/2;return t<i?(t-a)/(i-a):(r-t)/(r-i)}stopAll(){this.activeGlitches.forEach((e=>e.stop()))}destroyAll(){this.activeGlitches.forEach((e=>e.destroy())),this.activeGlitches.clear()}}"undefined"!=typeof module&&module.exports&&(module.exports=Glitchium),"undefined"!=typeof window&&(window.Glitchium=Glitchium);